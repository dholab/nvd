includeConfig "${projectDir}/conf/labkey.config"
includeConfig "${projectDir}/conf/results.config"

params {

    // WORKFLOW PARAMETERS TO REVIEW AT EACH RUN
    // ----------------------------------------

    // Samplesheet with the following columns:
    // sample_id,srr,platform,fastq1,fastq2
    samplesheet              = null
    // Where to place results
    results                  = "${launchDir}/results"

    // Which tool to run
    tools                    = null
    all                      = null
    stat                     = null
    nvd                      = null
    gottcha2                 = null
    clumpify                 = null

    // Experiment number to track
    experiment_id            = 2020202020

    max_concurrent_downloads = 3

    // whether to empty the work directory after the workflow
    // successfully finishes
    cleanup                  = null

    // GOTTCHA2 version https://ref-db.edgebioinformatics.org/gottcha2/RefSeq-r218/
    // Database hasn't been updated in almost 2 years...
    gottcha2_db_version      = "RefSeq-r218_24-Oct-2023"
    blast_db_version         = null


    // Resource file paths on staging
    gottcha2_db              = null
    nvd_files                = null
    blast_db                 = null
    blast_db_prefix          = null
    stat_index               = null
    stat_dbss                = null
    stat_annotation          = null
    human_virus_taxlist      = null


    // NVD settings
    cutoff_percent           = 0.001
    entropy                  = 0.9
    min_consecutive_bases    = 200
    qtrim                    = 't'
    tax_stringency           = 0.7
    include_children         = true
    human_virus_families     = [
        "Adenoviridae",
        "Anelloviridae",
        "Arenaviridae",
        "Arteriviridae",
        "Astroviridae",
        "Bornaviridae",
        "Peribunyaviridae",
        "Caliciviridae",
        "Coronaviridae",
        "Filoviridae",
        "Flaviviridae",
        "Hepadnaviridae",
        "Hepeviridae",
        "Orthoherpesviridae",
        "Orthomyxoviridae",
        "Papillomaviridae",
        "Paramyxoviridae",
        "Parvoviridae",
        "Picobirnaviridae",
        "Picornaviridae",
        "Pneumoviridae",
        "Polyomaviridae",
        "Poxviridae",
        "Sedoreoviridae",
        "Retroviridae",
        "Rhabdoviridae",
        "Togaviridae",
        "Kolmioviridae",
    ]

    // For final GOTTCHA2 BLAST verify step (WIP)
    verification_taxids      = [95341, 727]


    // WORKFLOW PARAMETERS THAT SHOULD NOT BE CHANGED
    // ----------------------------------------
    date                     = new java.util.Date().format('yyyyMMdd')

    // directory for workflow resource files
    resources                = "${projectDir}/resources"

    // Refman registry file
    refman_registry          = "${projectDir}/refman.toml"

    // mono-image filename or endpoint, if available
    monoimage                = "nrminor/nvd2:v0.1.0"
}

// Include the results publishing directories, which are configured in their own config
// file
includeConfig "${projectDir}/conf/results.config"


// WHETHER TO GENERATE A REPORT OF RUN STATISTICS
report {
    enabled   = true
    overwrite = true
    file      = "${params.results}/report.html"
}


// WHETHER TO GENERATE A VISUALIZATION OF THE WORKFLOW
dag {
    enabled   = true
    overwrite = true
    file      = 'workflow-visualization.png'
}


// WHETHER TO REMOVE TEMPORARY FILES AFTER A SUCCESSFUL RUN
cleanup = params.cleanup


// PROFILE OPTIONS
profiles {

    standard {

        apptainer.enabled = false
        docker.enabled    = false
        conda.enabled     = false
        process.executor  = 'local'
    }

    docker {

        docker.enabled    = true
        docker.temp       = 'auto'
        apptainer.enabled = false
        conda.enabled     = false

        process.container = "${params.monoimage}"
    }

    apptainer {

        apptainer.enabled    = true
        apptainer.cacheDir   = "work/apptainer/"
        apptainer.cacheDir   = "work/apptainer"
        apptainer.autoMounts = true
        docker.enabled       = false
        conda.enabled        = false

        process.container    = "docker://${params.monoimage}"
    }

    chtc_hpc {

        // container engine settings
        apptainer.enabled      = true
        apptainer.cacheDir     = "work/apptainer/"
        apptainer.cacheDir     = "work/apptainer"
        apptainer.autoMounts   = true

        // container address
        process.container      = "docker://${params.monoimage}"

        // slurm job settings
        process.executor       = "slurm"
        process.clusterOptions = "--partition=shared"
        process.maxForks       = 10
        process.cpus           = 20
        process.memory         = 64
        process.time           = 24.h
    }

    local {

        apptainer.enabled = false
        docker.enabled    = false
        conda.enabled     = false
        process.executor  = 'local'
    }
}


// MANIFEST
manifest {
    homePage      = ''
    mainScript    = 'main.nf'
    defaultBranch = 'main'
    description   = ''
    author        = ''
}
