params {

    // WORKFLOW PARAMETERS TO REVIEW AT EACH RUN
    // ----------------------------------------

    // LabKey integration
    // When enabled (--labkey), all labkey_* params below must be set.
    // Configure these in your user.config (~/.nvd/user.config) or via CLI.
    labkey                                  = false
    labkey_server                           = null
    labkey_project_name                     = null
    labkey_webdav                           = null
    labkey_schema                           = null
    labkey_gottcha_fasta_list               = null
    labkey_gottcha_full_list                = null
    labkey_gottcha_blast_verified_full_list = null
    labkey_blast_meta_hits_list             = null
    labkey_blast_fasta_list                 = null
    labkey_exp_id_guard_list                = null

    // Samplesheet with the following columns:
    // sample_id,srr,platform,fastq1,fastq2
    samplesheet               = null
    // Where to place results
    results                   = "${launchDir}/results"

    // Which tool to run
    tools                     = null

    // Experiment number to track
    experiment_id             = null

    max_concurrent_downloads  = 3

    // whether to empty the work directory after the workflow
    // successfully finishes
    cleanup                   = null

    // GOTTCHA2 version https://ref-db.edgebioinformatics.org/gottcha2/RefSeq-r220
    // Database hasn't been updated in almost 2 years...
    gottcha2_db_version       = "RefSeq-r220"
    blast_db_version          = "core-nt_2025-08-03"


    // Resource file paths on staging
    gottcha2_db               = null
    nvd_files                 = null
    blast_db                  = null
    blast_db_prefix           = null
    stat_index                = null
    stat_dbss                 = null
    stat_annotation           = null
    human_virus_taxlist       = null

    // whether to run all preprocessing of merged reads before classification
    preprocess                = false

    // whether to merge paired read mates based on overlaps between them
    merge_pairs               = null

    // whether to deduplicate sequencing reads
    dedup                     = null

    // Adapter trimming (Illumina only)
    trim_adapters             = null

    // Host read scrubbing in preprocessing (uses hostile)
    scrub_host_reads          = null

    // Path to local hostile index (for offline use); null enables auto-download
    hostile_index             = null

    // Standard hostile index name to use when hostile_index is null
    // Masked against viral + phage genomes to maximize viral read retention
    hostile_index_name        = "human-t2t-hla.rs-viral-202401_ml-phage-202401"

    // Path to human reads database for SRA submission scrubbing (clumpify workflow)
    sra_human_db              = null

    // DEPRECATED: Use sra_human_db instead. Kept for backward compatibility.
    human_read_scrub          = null

    // Quality and length filtering
    filter_reads              = null

    min_read_quality_illumina = 20
    min_read_quality_nanopore = 12
    min_read_length           = 50
    max_read_length           = null

    // NVD settings
    cutoff_percent            = 0.001
    entropy                   = 0.9
    min_consecutive_bases     = 200
    qtrim                     = 't'
    tax_stringency            = 0.7
    include_children          = true
    human_virus_families      = [
        "Adenoviridae",
        "Anelloviridae",
        "Arenaviridae",
        "Arteriviridae",
        "Astroviridae",
        "Bornaviridae",
        "Peribunyaviridae",
        "Caliciviridae",
        "Coronaviridae",
        "Filoviridae",
        "Flaviviridae",
        "Hepadnaviridae",
        "Hepeviridae",
        "Orthoherpesviridae",
        "Orthomyxoviridae",
        "Papillomaviridae",
        "Paramyxoviridae",
        "Parvoviridae",
        "Picobirnaviridae",
        "Picornaviridae",
        "Pneumoviridae",
        "Polyomaviridae",
        "Poxviridae",
        "Sedoreoviridae",
        "Retroviridae",
        "Rhabdoviridae",
        "Togaviridae",
        "Kolmioviridae",
    ]

    // minimum number of reads to use for gottcha2
    min_gottcha_reads         = 250

    // number of BLAST hits to consider before calling hits
    max_blast_targets         = 100

    // retain the top X many BLAST hits
    blast_retention_count     = 5


    // WORKFLOW PARAMETERS THAT SHOULD NOT BE CHANGED
    // ----------------------------------------
    date                      = new java.util.Date().format('yyyyMMdd')

    // directory for workflow resource files
    resources                 = "${projectDir}/resources"

    // Refman registry file
    refman_registry           = "${projectDir}/refman.toml"

    // mono-image filename or endpoint, if available
    monoimage                 = "nrminor/nvd2:v0.1.0"

    // State directory for run tracking, upload deduplication, and taxonomy cache.
    // Resolution priority:
    //   1. Explicit --state_dir parameter
    //   2. NVD_STATE_DIR environment variable
    //   3. Default: ~/.cache/nvd
    // When running in containers, this directory is automatically mounted
    // via Nextflow's path staging mechanism.
    state_dir                 = System.getenv('NVD_STATE_DIR') ?: "${System.getProperty('user.home')}/.cache/nvd"
}

// Include the results publishing dirs from their separate file
includeConfig "${projectDir}/conf/results.config"

// WHETHER TO GENERATE A REPORT OF RUN STATISTICS
report {
    enabled   = true
    overwrite = true
    file      = "${params.results}/report.html"
}


// WHETHER TO GENERATE A VISUALIZATION OF THE WORKFLOW
dag {
    enabled   = true
    overwrite = true
    file      = 'workflow-visualization.png'
}


// WHETHER TO REMOVE TEMPORARY FILES AFTER A SUCCESSFUL RUN
cleanup = params.cleanup


// PROFILE OPTIONS
profiles {

    standard {

        apptainer.enabled = false
        docker.enabled    = false
        conda.enabled     = false
        process.executor  = 'local'
    }

    docker {

        docker.enabled    = true
        docker.temp       = 'auto'
        apptainer.enabled = false
        conda.enabled     = false

        process.container = "${params.monoimage}"
    }

    apptainer {

        apptainer.enabled    = true
        apptainer.cacheDir   = "work/apptainer/"
        apptainer.cacheDir   = "work/apptainer"
        apptainer.autoMounts = true
        docker.enabled       = false
        conda.enabled        = false

        process.container    = "docker://${params.monoimage}"
    }

    chtc_hpc {

        // container engine settings
        apptainer.enabled      = true
        apptainer.cacheDir     = "work/apptainer/"
        apptainer.cacheDir     = "work/apptainer"
        apptainer.autoMounts   = true

        // container address
        process.container      = "docker://${params.monoimage}"

        // slurm job settings
        process.executor       = "slurm"
        process.clusterOptions = "--partition=shared"
        process.maxForks       = 10
        process.cpus           = 20
        process.memory         = 64
        process.time           = 24.h
    }

    local {

        apptainer.enabled = false
        docker.enabled    = false
        conda.enabled     = false
        process.executor  = 'local'
    }
}

// BLANKET PROCESS CONFIGURATIONS
process {
    withLabel: low {
        cpus   = 1
        memory = 4.GB
        disk   = 100.GB
    }

    withLabel: medium {
        cpus   = 6
        memory = 12.GB
        disk   = 250.GB
    }

    withLabel: high {
        cpus   = 20
        memory = 64.GB
        disk   = 500.GB
    }

    withLabel: ludicrous {
        cpus   = 20
        memory = 450.GB
        disk   = 1000.GB
    }
}

// MANIFEST
manifest {
    homePage      = ''
    mainScript    = 'main.nf'
    defaultBranch = 'main'
    description   = ''
    author        = ''
}
