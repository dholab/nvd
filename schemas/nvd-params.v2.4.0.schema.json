{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/dhoconno/nvd/state-management/schemas/nvd-params.v2.4.0.schema.json",
  "title": "NVD Pipeline Parameters",
  "description": "Parameters for the Novel Virus Detection (NVD) metagenomics pipeline. Use with Nextflow's -params-file option or register as a preset with nvd preset register.",
  "type": "object",
  "properties": {
    "labkey": {
      "type": "boolean",
      "default": false,
      "description": "Enable LabKey integration for result uploads. When enabled, all labkey_* params must be set."
    },
    "labkey_server": {
      "type": "string",
      "description": "LabKey server URL"
    },
    "labkey_project_name": {
      "type": "string",
      "description": "LabKey project name"
    },
    "labkey_webdav": {
      "type": "string",
      "description": "LabKey WebDAV endpoint URL"
    },
    "labkey_schema": {
      "type": "string",
      "description": "LabKey schema name"
    },
    "labkey_gottcha_fasta_list": {
      "type": "string",
      "description": "LabKey list name for GOTTCHA2 FASTA uploads"
    },
    "labkey_gottcha_full_list": {
      "type": "string",
      "description": "LabKey list name for GOTTCHA2 full results"
    },
    "labkey_gottcha_blast_verified_full_list": {
      "type": "string",
      "description": "LabKey list name for BLAST-verified GOTTCHA2 results"
    },
    "labkey_blast_meta_hits_list": {
      "type": "string",
      "description": "LabKey list name for BLAST meta hits"
    },
    "labkey_blast_fasta_list": {
      "type": "string",
      "description": "LabKey list name for BLAST FASTA uploads"
    },
    "labkey_exp_id_guard_list": {
      "type": "string",
      "description": "LabKey list name for experiment ID guard (prevents duplicate uploads)"
    },
    "samplesheet": {
      "type": "string",
      "format": "path",
      "description": "Path to samplesheet CSV with columns: sample_id, srr, platform, fastq1, fastq2"
    },
    "results": {
      "type": "string",
      "format": "path",
      "description": "Directory for pipeline output files"
    },
    "tools": {
      "type": "string",
      "pattern": "^(stat_blast|nvd|stat|blast|stast|gottcha|all|clumpify)(,(stat_blast|nvd|stat|blast|stast|gottcha|all|clumpify))*$",
      "description": "Which analysis tool(s) to run. Valid tools: stat_blast, nvd, stat, blast, gottcha, all, clumpify. For multiple tools, use comma-separated values with no spaces (e.g., 'stat,blast,gottcha'). Use 'all' to run the complete pipeline."
    },
    "experiment_id": {
      "type": "string",
      "description": "Experiment identifier for tracking and LabKey integration"
    },
    "max_concurrent_downloads": {
      "type": "integer",
      "default": 3,
      "minimum": 1,
      "description": "Maximum number of concurrent SRA downloads"
    },
    "cleanup": {
      "type": "boolean",
      "description": "Whether to empty the work directory after successful completion"
    },
    "work_dir": {
      "type": ["string", "null"],
      "format": "path",
      "description": "Nextflow work directory for intermediate files"
    },
    "gottcha2_db_version": {
      "type": "string",
      "description": "GOTTCHA2 database version identifier"
    },
    "blast_db_version": {
      "type": "string",
      "description": "BLAST database version identifier"
    },
    "stat_db_version": {
      "type": "string",
      "description": "STAT database version identifier"
    },
    "gottcha2_db": {
      "type": "string",
      "format": "path",
      "description": "Path to GOTTCHA2 database directory"
    },
    "nvd_files": {
      "type": "string",
      "format": "path",
      "description": "Path to NVD resource files directory"
    },
    "blast_db": {
      "type": "string",
      "format": "path",
      "description": "Path to BLAST database directory"
    },
    "blast_db_prefix": {
      "type": "string",
      "description": "BLAST database name prefix"
    },
    "stat_index": {
      "type": "string",
      "format": "path",
      "description": "Path to STAT index file"
    },
    "stat_dbss": {
      "type": "string",
      "format": "path",
      "description": "Path to STAT DBSS file"
    },
    "stat_annotation": {
      "type": "string",
      "format": "path",
      "description": "Path to STAT annotation file"
    },
    "human_virus_taxlist": {
      "type": "string",
      "format": "path",
      "description": "Path to human virus taxonomy list file"
    },
    "preprocess": {
      "type": "boolean",
      "default": false,
      "description": "Run all preprocessing steps on reads before classification (enables dedup, trim_adapters, scrub_host_reads, filter_reads)"
    },
    "merge_pairs": {
      "type": "boolean",
      "description": "Merge paired read mates based on overlaps between them"
    },
    "dedup": {
      "type": "boolean",
      "description": "Deduplicate sequencing reads"
    },
    "trim_adapters": {
      "type": "boolean",
      "description": "Trim Illumina adapters from reads"
    },
    "scrub_host_reads": {
      "type": "boolean",
      "description": "Remove host (human) reads using STAT. Requires sra_human_db to be set."
    },
    "sra_human_db": {
      "type": "string",
      "format": "path",
      "description": "Path to human reads STAT database for host scrubbing and SRA submission prep"
    },
    "human_read_scrub": {
      "type": "string",
      "format": "path",
      "deprecated": true,
      "description": "DEPRECATED: Use sra_human_db instead. Path to human reads database for SRA submission scrubbing"
    },
    "filter_reads": {
      "type": "boolean",
      "description": "Apply quality and length filtering to reads"
    },
    "min_read_quality_illumina": {
      "type": "integer",
      "default": 20,
      "minimum": 0,
      "description": "Minimum average quality score for Illumina reads"
    },
    "min_read_quality_nanopore": {
      "type": "integer",
      "default": 12,
      "minimum": 0,
      "description": "Minimum average quality score for Nanopore reads"
    },
    "min_read_length": {
      "type": "integer",
      "default": 50,
      "minimum": 1,
      "description": "Minimum read length to retain"
    },
    "max_read_length": {
      "type": "integer",
      "minimum": 1,
      "description": "Maximum read length to retain (no limit if not specified)"
    },
    "cutoff_percent": {
      "type": "number",
      "default": 0.001,
      "minimum": 0,
      "maximum": 1,
      "description": "Minimum abundance threshold for reporting taxa (0-1)"
    },
    "entropy": {
      "type": "number",
      "default": 0.9,
      "minimum": 0,
      "maximum": 1,
      "description": "Entropy threshold for sequence complexity filtering (0-1)"
    },
    "min_consecutive_bases": {
      "type": "integer",
      "default": 200,
      "minimum": 1,
      "description": "Minimum number of consecutive bases required"
    },
    "qtrim": {
      "type": "string",
      "default": "t",
      "description": "Quality trimming mode"
    },
    "tax_stringency": {
      "type": "number",
      "default": 0.7,
      "minimum": 0,
      "maximum": 1,
      "description": "Stringency for taxonomic classification (0-1)"
    },
    "include_children": {
      "type": "boolean",
      "default": true,
      "description": "Include child taxa in taxonomic analysis"
    },
    "human_virus_families": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "default": [
        "Adenoviridae",
        "Anelloviridae",
        "Arenaviridae",
        "Arteriviridae",
        "Astroviridae",
        "Bornaviridae",
        "Peribunyaviridae",
        "Caliciviridae",
        "Coronaviridae",
        "Filoviridae",
        "Flaviviridae",
        "Hepadnaviridae",
        "Hepeviridae",
        "Orthoherpesviridae",
        "Orthomyxoviridae",
        "Papillomaviridae",
        "Paramyxoviridae",
        "Parvoviridae",
        "Picobirnaviridae",
        "Picornaviridae",
        "Pneumoviridae",
        "Polyomaviridae",
        "Poxviridae",
        "Sedoreoviridae",
        "Retroviridae",
        "Rhabdoviridae",
        "Togaviridae",
        "Kolmioviridae"
      ],
      "description": "List of virus family names to include in human virus analysis"
    },
    "min_gottcha_reads": {
      "type": "integer",
      "default": 250,
      "minimum": 1,
      "description": "Minimum number of reads required for GOTTCHA2 analysis"
    },
    "max_blast_targets": {
      "type": "integer",
      "default": 100,
      "minimum": 1,
      "description": "Maximum number of BLAST hits to consider before calling hits"
    },
    "blast_retention_count": {
      "type": "integer",
      "default": 5,
      "minimum": 1,
      "description": "Number of top BLAST hits to retain"
    },
    "state_dir": {
      "type": "string",
      "format": "path",
      "description": "State directory for run tracking, upload deduplication, and taxonomy cache. Defaults to NVD_STATE_DIR env var or ~/.cache/nvd"
    },
    "refman_registry": {
      "type": "string",
      "format": "path",
      "description": "Path to refman registry file for reference management"
    },
    "monoimage": {
      "type": "string",
      "default": "nrminor/nvd:v2.4.0",
      "description": "Container image to use for pipeline execution"
    },
    "slack_enabled": {
      "type": "boolean",
      "default": false,
      "description": "Enable Slack notifications for run completion (stat_blast workflow only)"
    },
    "slack_channel": {
      "type": "string",
      "pattern": "^C[A-Z0-9]+$",
      "description": "Slack channel ID for notifications (e.g., 'C0123456789')"
    },
    "stateless": {
      "type": "boolean",
      "default": false,
      "description": "Run without state management (disables run tracking, sample locking, LabKey, and Slack). When enabled, state_dir is ignored and taxonomy_dir must be set."
    },
    "taxonomy_dir": {
      "type": ["string", "null"],
      "format": "path",
      "description": "Path to taxonomy database directory containing NCBI taxdump files. Defaults to {state_dir}/taxdump when state_dir is set. Required when stateless=true."
    }
  },
  "additionalProperties": false
}
